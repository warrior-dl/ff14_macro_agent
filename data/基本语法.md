### 代名词
代名词是文本指令的一种特殊形式，一般形如<...>，替代用户输入一段可随当前状态改变的文本。

在文本指令中使用代名词，可以指定文本指令的一些参数和对象。如`/ac 退避 <2>`可以指定文本指令`/ac 退避`向2号队员使用。

在发送信息时使用代名词，发送时会自动将代名词替换成对应的内容。对应的内容不存在时，会显示为空字符。例如，假设2号队员叫XXX，发送`已退避<2>！`时会自动变成`已退避XXX！`，没有组队时则会变成`已退避！`。

在信息中使用代名词时，大部分代名词的替换在收到信息者的客户端进行，因此在国际服，代名词可以正确显示出对应的内容在对方客户端语言中的文本。（但是`<item>`例外，虽然道具链接会正确显示出对方客户端语言中的文本，但道具的名字在对话框中会显示为发送者客户端中的文本）

以下是一些值得额外解释的代名词：

| 代名词 | 解释 |
| -- | -- | 
| `<le>` | 最后选中的敌人的名字 (当前目标是敌人时，显示当前目标，否则显示上个选中的敌人) |
| `<mo>` | 当前鼠标指向的目标的名字，指向小队列表/仇恨列表/目标模型都可以（手柄的预选中状态不行） |
| `<attack>` | 所有已标记的`攻击1~5`记号中序号最小的标记目标的名字 |
| `<bind>` | 所有已标记的`止步1~3`记号中序号最小的标记目标的名字 |
| `<stop>` | 所有已标记的`禁止1~2`记号中序号最小的标记目标的名字 |
| `<pos>` | 自己的地区名和坐标（地图链接，可以被点击标记） |
| `<flag>` | 标记的地区名和坐标（地图链接，可以被点击标记）。如果没有标记，则显示为`【没有设置地图链接的目标】`。用 `Ctrl+鼠标右键` 在地图上标记时，会自动输入对话框中。 |
| `<item>` | 最近选择过`展示道具属性`的道具链接。装备上的魔晶石、签名、精炼度、耐久等不能正确显示，只能显示基本属性。如果最近没有选择过`展示道具属性`，则会替换为空字符。选择“展示道具属性”时，会自动输入对话框中。 |
| `<se.1>~<se.16>` | 特殊代名词，不会替换为其他内容。在小队/团队/默语频道中发送时，对所有收到信息的玩家播放对应的音效。可写为`<se>`，会被自动随机补全为`<se.X>`。 |
| `<wait.秒数>` | 特殊代名词，不会显示在消息中且自身之后的内容全部消失。这条消息发送后令正在运行的宏暂停指定的秒数（如果宏正处于暂停状态，会刷新暂停时间为自身所指定的）。秒数只能设置为1~60的整数，小数会被四舍五入，大于60会视为60，小于1或写为`<wait>`会视为1。 | 
| `<recast.技能名>` | 指定技能的剩余冷却时间，格式为 `分:秒`，因此不能用来作为wait的时间参数。已冷却完毕的技能会显示为 `--:--`。只有当前职业的技能可以被正确显示，并且不能用定型文（技能名中间有空格的语言不需要加引号，英文大小写不敏感）。 |

<details>
<summary>全部代名词</summary>

| 代名词 | 解释 |
| -- | -- | 
| `<t>` | 当前选中目标的名字 |
| `<tt>` | 当前选中目标的选中目标的名字 |
| `<me>` | 自己的名字 |
| `<r>` | 上一个悄悄话你的人的名字 |
| `<1>~<8>` | 小队列表中对应编号的人的名字 |
| `<f>` | 焦点目标的名字 |
| `<lt>` | 上个选中的目标的名字 |
| `<le>` | 最后选中的敌人的名字 (当你的当前目标是敌人时，会显示你的当前目标，否则显示上个选中的敌人) |
| `<la>` | 上个对自己造成伤害的敌人的名字 |
| `<c>` | 自己的陆行鸟的名字 |
| `<p>` | 自己的召唤物的名字 |
| `<attack1>~<attack5>` | 被标记了“攻击1~5”记号的目标的名字（可写为`<attack>`，表示所有已标记的攻击记号中序号最小的标记目标的名字） |
| `<bind1>~<bind3>` | 被标记了“止步1~3”记号的目标的名字（可写为`<bind>`，表示所有已标记的止步记号中序号最小的标记目标的名字） |
| `<stop1>~<stop2>` | 被标记了“禁止1~2”记号的目标的名字（可写为`<stop>`，表示所有已标记的禁止记号中序号最小的标记目标的名字） |
| `<square>` | 被标记了“方块”记号的目标的名字 |
| `<circle>` | 被标记了“圆圈”记号的目标的名字 |
| `<cross>` | 被标记了“十字”记号的目标的名字（在J端为`<plus>`） |
| `<triangle>` | 被标记了“三角”记号的目标的名字 |
| `<mo>` | 当前鼠标指向的目标的名字，指向小队列表/仇恨列表/目标模型都可以（手柄的预选中状态不行） |
| `<hp>` | 自己的当前体力值/最大体力值 |
| `<hpp>` | 自己的当前体力百分比 |
| `<mp>` | 自己的当前魔力值/最大魔力值 |
| `<mpp>` | 自己的当前魔力百分比 |
| `<job>` | 自己的当前职业(等级) |
| `<pos>` | 自己的地区名和坐标（地图链接，可以被点击标记） |
| `<se.1>~<se.16>` | 特殊代名词，不会替换为其他内容。在小队/团队/默语频道中发送时，对所有收到信息的玩家播放对应的音效。可写为`<se>`，会被自动随机补全为`<se.X>`。 |
| `<buddyhp>` | 自己召唤出的搭档（陆行鸟）体力的当前值/最大值。 | 
| `<buddyhpp>` | 自己召唤出的搭档（陆行鸟）体力百分比 | 
| `<wait.秒数>` | 特殊代名词，发送时不会显示且使得自身之后的内容全部消失，这条消息发送后令正在运行的宏暂停指定的秒数（如果宏正处于暂停状态，会刷新暂停时间为自身所指定的）。秒数只能设置为1~60的整数，小数会被四舍五入，大于60会视为60，小于1或省略秒数会视为1。 | 
| `<recast.技能名>` | 指定技能的剩余冷却时间，格式为 `分:秒`，因此不能用来作为wait的时间参数。已冷却完毕的技能会显示为 `--:--`。只有当前职业的技能可以被正确显示，并且不能用定型文（技能名中间有空格的语言不需要加引号，英文大小写不敏感）。 |
| `<targethpp>` | 当前选中目标的体力百分比 | 
| `<focushpp>` | 焦点目标的体力百分比 | 
| `<targetjob>` | 当前选中目标的职业(等级) | 
| `<focusjob>` | 焦点目标的职业(等级) | 
| `<e1>~<e5>` | 水晶冲突中的对方1-5号玩家的名字 |
| `<item>` | 最近选择过`展示道具属性`的道具链接。装备上的魔晶石、签名、精炼度、耐久等不能正确显示，只能显示基本属性。如果最近没有选择过`展示道具属性`，则会替换为空字符。选择“展示道具属性”时，会自动输入对话框中。 |
| `<flag>` | 标记的地区名和坐标（地图链接，可以被点击标记）。如果没有标记，则显示为`【没有设置地图链接的目标】`。用 `Ctrl+鼠标右键` 在地图上标记时，会自动输入对话框中。 |

</details>

### 宏
输入文本指令是非常繁琐的，我们把常用的文本指令存储在一个批处理程序里，这样我们就可以直接执行这个程序来快速输入文本指令，这个程序就是**宏**。一个宏最多可以保存15行文本指令。

宏的功能是内将其中储存的每行内容以**每行1帧**的速度依次输入聊天框发送，直到遇到**第一个空白行**结束。这个行为在客户端**本地处理**，不受网络因素影响。（如果宏中有不是`/`起头的语句，它会被作为一句话发送到当前默认聊天频道）

宏不能同时运行多个，如果在一个宏未运行完之前运行另一个宏，当前运行的宏会立刻停止运行。如果正在运行的宏有宏锁保护，那么在运行完之前，任何其他宏都无法运行。（直接从对话框输入文本指令不会打断宏的运作，也不受宏锁的控制）

宏可以运行几乎所有文本指令，还可以使用宏专用指令对宏的运行进行部分控制，但这部分指令并不包含判断和循环结构，所以无法实现绝大部分基于条件判断的编程化指令。


## 第二节 初等宏
### 技能
官方对`/技能`（缩写为`/ac`）指令的说明如下：
```
/技能 技能名 代名词
/action、/ac
对指定目标使用指定技能。如果身处无法使用技能的环境，或者还没有学会指定技能，则命令无效。

在技能会使用到地面目标的情况下，为技能名后设定子命令可以指定操作模式。
代名词
  省略地面目标模式，直接向指定目标发动技能。
地面关
  省略地面目标模式，直接发动技能。
>>示例
/技能 重劈 <目标>
对当前所选择的目标执行技能“重劈”。
/技能 治疗 <2>
对小队列表中的2号队员执行技能“治疗”。
/技能 缩地 <目标>
对选择目标的位置执行技能“缩地”。
/技能 缩地 地面关
对所指的位置直接执行技能“缩地”。
```
- 省略代名词时，技能的目标与你在当前状态下正常通过热键使用技能的目标一致。
- 如果当前按下这个热键不能立刻发动技能（超出射程，技能处于冷却中，动作硬直等），这个指令无效。
- 无法指定“不可设置到热键栏”的技能，需要指定此类技能时，应指定变化为此技能的原始技能。例如`纷乱雪月花`必须写作`居合术`，`赤神圣`必须写作`赤疾风`。
- 如果指定的技能已被升级后的技能取代，会自动改为释放升级后的技能，若指定未学会的升级后的技能，会自动改为升级前技能。
- 指定对目标使用的地面技能为圆形范围时，会以目标环的圆心为技能圆心放置。如果目标环圆心超出技能圆心射程，即使技能范围可以扫到，技能仍然不会释放。这一点在目标距离较远/目标体积巨大时需要特别注意。
- 地面关可以简写为gtoff，直接对鼠标所指的位置释放地面目标技能。（注意不要写成`<gtoff>`）
- 并非所有技能都通过该命令指定，部分技能应使用 `/generalaction`、`/blueaction`、`/pvpaction`、`/companionaction` 或 `/petaction` 指定。

可以说，99%玩家的战斗宏之旅都是从这里开始的。这个简单粗暴的命令似乎有着无穷的魅力，诱惑萌新去使用。在对游戏和宏的机制不太了解的情况下，很容易想当然的写出一些一键输出宏。

但是，很快人们发现，这个指令很坑。

正常使用技能热键释放技能时，有一个特殊辅助机制：**技能队列**。当你按下一个技能热键时，如果当前状态不能释放这个技能，但是在大约0.5s以内就可以释放这个技能，那么这个技能就会加入技能队列，并在你变得可以释放这个技能的下一帧自动释放出去。因此，通过技能热键释放GCD技能，可以平滑的过渡到下一个技能，使得GCD永远处于冷却中，避免GCD转好到下一次点击技能之间的不可避免的损失。

然而，通过文本指令`/ac`释放技能，不享受这个技能队列的机制。以每0.2s点击一次的速度计算，平均每次用`/ac`释放GCD技能，都会使GCD空转0.1s，俗称“卡宏”。**连续使用单独的 `/ac` 指令释放GCD技能，会导致GCD卡顿而降低输出**。

因为这样的缺点，这个指令我们一般不会单独用于GCD技能，往往用于能力技，以及生产采集职业。这个指令最主要的好处是可以通过代名词指定目标，而不用实际选中目标。

### 等待
官方对`/等待`（`/wait`）指令的说明如下：
```
/等待 等待时间
/wait
宏专用指令。可以让宏在等待指定时间后发动。
设置等待时间的数值时，“1”大约相当于1秒，且只可以设置整数。
等待时间最多可以设置为60，超过60时按60算。
```
- wait指令被读取时，正在运行的宏会暂停规定的秒数，然后继续输入。
- 在对话框中直接输入wait指令也可以影响正在运行的宏，如果该宏正在等待，会将等待时间刷新为新的指定时间。
- 等待时间可以省略，自动默认为1s。
- 等待时间其实可以输入小数，但会被四舍五入到整数。
- 代名词`<wait.X>`与`/wait`具有相同的作用，但是`<wait.X>`可以不单独占用一行，能更充分利用15行空间。（值得一提的是，在对话框中输入文本指令时，`<wait.x>`不用空格隔开会报错，但在宏里可以不带空格正常使用。~~笔者因为这个和人打赌输了一瓶幻想药~~）

由于宏只能同时运行一个，没有宏锁的wait很容易被其他宏打断，有宏锁的wait有时会阻碍其他宏操作，所以我们一般不会使用比较长的wait，除非确定一定时间内没有别的宏需要被使用。

### 发送信息
通过文本指令，可以快速发送信息，提示他人。

为了避免刷屏，部分公共频道设置了连续发言限制，玩家每秒只能在每个有限制的频道发送一条消息。

这里陈列了一些发送/处理对话框信息的文本指令及各个频道的特征：

| 文本指令 | 对应频道及说明 |
| -- | -- |
| /s | 说话频道，可见范围比较小，对连续发言有限制。（即使受到连续发言限制，要求说话的任务也视为完成） |
| /em | 情感动作频道，和说话频道基本相同，ID和内容之间没有冒号。对连续发言有限制，但在受到限制时不会收到系统提示。 |
| /y | 呼喊频道，可见范围比说话频道大一些，对连续发言有限制。 |
| /sh | 喊话频道，该地图内全屏可见，对连续发言有限制。 |
| /tell | 悄悄话频道，格式`/tell 人物名@服务器名(同服省略) 内容`，对连续发言有限制，省略内容将改变悄悄话默认目标。 |
| /reply | 悄悄话频道，送信目标为上一个给你发悄悄话人，不会因为下线而消除。 |
| /p | 小队频道，不限制连续发言，`<se>`提示音有效。 |
| /a | 团队频道，不限制连续发言，`<se>`提示音有效。 |
| /fc | 部队频道，不限制连续发言。 |
| /pvpteam | 战队频道，~~我还没有~~ |
| /cwl`x` | 跨服通讯贝频道，`x`为通讯贝编号，省略则为最近一个激活的通讯贝——最近一个激活可以是用指令发言(未切换频道)或者主动切换默认频道(不管有没有发言)，省略内容将改变默认频道，不限制连续发言 |
| /l`x` | 通讯贝频道，`x`为通讯贝编号，省略则为最近一个激活的通讯贝——最近一个激活可以是用指令发言(未切换频道)或者主动切换默认频道(不管有没有发言)，省略内容将改变默认频道，不限制连续发言 |
| /b | 新人频道，不限制连续发言 |
| /e | 默语频道，仅自己可见，发送速度比其他频道都快得多，`<se>`提示音有效 |
| /cth | 清除悄悄话记录，清除的实际上是曾悄悄话过的对象而不是悄悄话内容 |
| /cl | 清空对话框内的所有信息 |

### 宏图标
```
/宏图标 图标名 分类名
/macroicon、/micon
用户宏专用。在热键栏上显示指定图标名的图标，在同一个用户宏命令内只能生效一次。
>>分类名
技能(action)
  …将技能名指定到图标名上，可以显示出该技能的图标及技能的复唱时间、所需魔力等情报。
青魔法技能(blueaction)
  …将技能名指定到图标名上，可以显示出该技能的图标及技能的复唱时间、所需魔力等情报。
对战技能(pvpaction)
  …将对战技能名指定到图标名上，可以显示出该技能的图标及技能的复唱时间、所需魔力等情报。
共通技能(general)
  …将共通技能名指定到图标名上，可以显示出该技能的图标及技能的复唱时间。
情感动作(emote)
  …将情感动作名指定到图标名上，可以显示出该情感动作的图标。
搭档(buddy) 搭档名
  …将搭档技能名指定到图标名上，可以显示出该技能的图标。搭档名可以省略。
召唤兽(pet)
  …将召唤兽技能名指定到图标名上，可以显示出该技能的图标。
宠物(minion)
  …将宠物名指定到图标名上，可以显示出该宠物的图标。
坐骑(mount)
  …将坐骑名指定到图标名上，可以显示出该坐骑的图标。
道具(item)
  …将道具名指定到图标名上，可以显示出该道具的图标和持有数量。
标记(marking)
  …将标记名指定到图标名上，可以显示出该标记的图标。
场景标记(waymark)
  …将场景标记名指定到图标名上，可以显示出该场景标记的图标。
套装(gearset)
  …将套装编号指定到图标名上，可以显示出该套装的图标。
职业(classjob)
  …将职业名指定到图标名上，可以显示出该职业的图标。
快捷发言(quickchat)
  …将快捷发言名指定到图标名上，可以显示出该快捷发言的图标。
※省略分类
  …会按照技能名来处理。
```
- 为了区别真正的热键和只是指定为该热键图标的宏，宏的右上角会有一个小齿轮。
- 除了使用`/micon`指定图标以外，也可以在宏面板上选择使用预置图标。
- 如果指定的技能已被升级后的技能取代，会自动变为升级后的技能的技能图标，若指定未学会的升级后的技能，会自动变为升级前技能的技能图标。如果在其他职业下，会显示为该技能的最低级图标。
- 该图标会显示该技能的可用性。如果指定的技能在特定条件下会变化为其他技能，该宏的图标在满足条件时也会相应改变。
- 可以指定“不可设置到热键栏的技能”并正确显示出他们的图标。
- 指定道具作为图标的时候，你的背包里必须有该道具才能成功，且HQ与否必须对应。
- 制造职业的名字相同而图标不同的技能会自动跟随职业变换，在非生产职业下显示为刻木匠的图标。

这个指令是用来装饰你的宏的，值得一提的是，这个指令虽然没有实际作用，但在宏运行时需要一帧来处理，所以最好写在宏的最后。

### 宏控制
#### 取消宏
```
/取消宏
/macrocancel、/mcancel
只能在对话栏中输入。停止正在执行的宏指令。
```
- 放在宏里执行无效，但也算执行了一个空宏，所以可以打断没有被锁定的宏。
- 该指令有一个等效快捷键 `停止宏指令`。 (没有默认键位，需要自己在键位设置-系统中设置)

#### 锁定宏指令
```
/锁定宏指令(/锁宏)
/macrolock、/mlock
宏指令专用，使用该命令之后，在同一个宏内的所有指令完成之前不允许执行其他宏指令。
```
- 宏锁的保护只对这行指令的下方指令起效。
- 将有宏锁的宏打断的方法是使用 `/mcancel` 或者 `停止宏指令` 快捷键。

这个指令可以防止重要的宏被打断，同时，它也会降低宏的灵活度。是否要使用它因人而异。

#### 宏错误提示
```
/宏错误提示 子命令
/macroerror、/merror
宏命令专用。设置是否显示在运行宏命令的过程中出现的错误提示。宏命令运行前默认为显示状态。宏命令结束后，即使之前设置成了不显示状态，也会自动回到默认的显示状态。
>>子命令
开(on)
  显示错误提示。
关(off)
  不显示错误提示。
无子命令
  在显示与不显示之间切换。
```
- 关闭报错只对这行指令的下方指令起效。
- 只能关闭在对话框中显示的错误，不能关闭在屏幕中间弹出的错误提示。

一般只用`/merror off`，可以屏蔽一些因为复合宏逻辑而产生的对话框报错。

### 示例
以下是一些常用的初等宏。示例中的重复`/ac`可复制更多行以改善手感。
- 释放指定地面目标的能力技。因为这些技能本来就无法享受技能队列机制，这样可以省去点击地面或再次点击热键的时间。
  ```
  /ac 野战治疗阵 <t>
  /ac 野战治疗阵 <t>
  /micon 野战治疗阵
  ```
  ```
  /ac 缩地 gtoff
  /ac 缩地 gtoff
  /micon 缩地
  ```
- 在不选中目标的情况下对目标快速使用技能。
  ```
  /ac 以太步 <mo>
  /ac 以太步 <mo>
  /micon 以太步
  ```
  ```
  /ac 退避 <2>
  /ac 退避 <2>
  /micon 退避
  ```
- 按照优先级释放技能。值得一提的是，如果在等待硬直/冷却时连按，有小概率发生优先级低的技能先释放的情况。（帧数越高，事故发生率越低，按每0.2s点击一次计算，60帧约8%，144帧约3%）。
  ```
  /ac 集中加工
  /ac 加工
  /micon 加工
  ```
  ```
  /ac 扇舞·急
  /ac 扇舞·急
  /ac 扇舞·序
  /micon 扇舞·序
  ```
- 一键生产。
  ```
  /ac 工匠的神速技巧 <wait.3>
  /ac 崇敬 <wait.2>
  /ac 坯料制作 <wait.3>
  /ac 坯料制作
  ```
- 开怪前倒计时给有特殊需求的职业。
  ```
  /cd 20
  /p 还有20s开怪 <se.1><wait.5>
  /p 还有15s开怪 <se.1><wait.5>
  /p 还有10s开怪 <wait.1>
  /p 还有9s开怪 <wait.1>
  /p 还有8s开怪 <wait.1>
  /p 还有7s开怪 <wait.1>
  /p 还有6s开怪 <wait.1>
  ```
- 划水摸鱼。~~假装自己可以wait2.5~~
  ```
  /ac 神圣 <wait.3>
  /ac 神圣 <wait.3>
  /micon 神圣
  ```
- 在发动技能后喊话提示，可再加入`/wait`防止刷屏。
  ```
  /ac 死斗
  /ac 死斗
  /p 死斗已开启！<se.1>
  /micon 死斗
  ```
  ```
  /ac 退避 <2>
  /ac 退避 <2>
  /ac 退避 <2> <wait.1>
  /p 已退避 <2> ！
  /micon 退避
  ```
- 整合上坐骑和冲刺，在可以上坐骑的地方上坐骑，不能上坐骑的地方开冲刺。如果想在可以上坐骑的地方开冲刺，需要跳起来按。
  ```
  /mount 坐骑名
  /ac 冲刺
  /ac 冲刺
  /micon 冲刺
  ```